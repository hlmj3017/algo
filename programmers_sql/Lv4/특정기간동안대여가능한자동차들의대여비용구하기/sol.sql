-- 2022년 11월 1일부터 2022년 11월 30일까지 대여 가능

-- start_date가 2022년 11월 1일부터 2022년 11월 30일 사이에 있으면 안된다.
-- end_date가 2022년 11월 1일부터 2022년 11월 30일 사이에 있으면 안된다.
-- start_date가 2022년 11월 1일보다 작고, end_date가 2022년 11월 30일보다 크면 안된다.

-- 코드를 입력하세요
SELECT A.CAR_ID, A.CAR_TYPE, ROUND(DAILY_FEE * 30 * (100-DISCOUNT_RATE)/100) AS FEE
FROM CAR_RENTAL_COMPANY_CAR A
JOIN CAR_RENTAL_COMPANY_RENTAL_HISTORY B ON A.CAR_ID = B.CAR_ID
JOIN CAR_RENTAL_COMPANY_DISCOUNT_PLAN C ON A.CAR_TYPE = C.CAR_TYPE
WHERE A.CAR_ID NOT IN (SELECT CAR_ID
FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
WHERE START_DATE BETWEEN '2022-11-01' AND '2022-11-30'
OR END_DATE BETWEEN '2022-11-01' AND '2022-11-30'
OR (START_DATE <= '2022-11-01' AND END_DATE >= '2022-11-30')) AND C.DURATION_TYPE = '30일 이상' 
GROUP BY A.CAR_ID 
HAVING A.CAR_TYPE IN ('세단', 'SUV') AND (FEE BETWEEN 500000 AND 2000000)
ORDER BY FEE DESC, CAR_TYPE, CAR_ID DESC